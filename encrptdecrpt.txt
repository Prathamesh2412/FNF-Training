using ExpenseManager.Models;
using Microsoft.AspNetCore.Mvc;

namespace ExpenseManager.Controllers
{
    public class ExpenseController : Controller
    {
        private readonly ExpenseDbContext _ExpenseDbContext;

        public ExpenseController(ExpenseDbContext context)
        {
            this._ExpenseDbContext = context;
        }
        public JsonResult AllExpens()
        {
            var ExpenseList = _ExpenseDbContext.Expenses.ToList();
            return Json(ExpenseList);
        }

        [HttpPost]
        public string AddExpense(Expense expense)
        {
            _ExpenseDbContext.Expenses.Add(expense);
            _ExpenseDbContext.SaveChanges();
            return "Expense added";
        }

        public JsonResult FindByDesc(string desc)
        {
            var found = _ExpenseDbContext.Expenses.FirstOrDefault(e=>e.ExpenseDesc.Contains(desc));
            return Json(found);
        }

        public JsonResult SearchByMonth(int month)
        {
            var found = _ExpenseDbContext.Expenses.FirstOrDefault(s=>s.ExpenseDate.Month==month);
            return Json(found);
        }

        public JsonResult SearchByDate(DateTime date)
        {
            var found = _ExpenseDbContext.Expenses.FirstOrDefault(s=>s.ExpenseDate.Date==date);
            return Json(found);
        }
    }
}

<!DOCTYPE html>
<html>
<head>
    <title>Expense Manager</title>
    <script src="./lib/jquery/jquery-3.7.1.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <script>
        const url = "/Expense/AllExpens"
        function createRow(Movie) {
            const row = `<tr>
                                <td>${Expense.ExpenseId}</td>
                               <td>${Expense.ExpenseAmount}</td>
                                      <td>${Expense.ExpenseDesc}</td>
                                      <td>${Expense.ExpenseDate}</td>
                                       
                                        </tr>`
            return row;
        }
        function onGetRecordsSuccess(result) {
            $("table tbody tr").remove();
            $.each(result, function (index, value) {
                const row = createRow(value)
                $("table tbody").append(row);
            })
        }
        function ShowRecords() {
            $.get(url, onGetRecordsSuccess)
        }
        // function findRecords() {
        //     const title = $("#txtSearch").val()
        //     const findUrl = `Movie/Find?title=${title}`

        //     $.get(findUrl, onGetRecordsSuccess);

        // }
        function addRecords() {
            const url = "Expense/AddExpense";
             let movie = {
                "ExpenseId": 1,
                "ExpenseAmount": 989,
                "ExpenseDesc": "Eatires",
                "ExpenseDate": 29/02/2024,
             }
             $.post(url, movie, (res) => {
                 alert(res);
             })
        }
        function deleteRecords() {
            alert("delete")
        }

        function init() {
            $("#btnShow").click(ShowRecords);
            $("#btnFind").click(findRecords);
            $("#btnAdd").click(addRecords);
           
        }
        $(document).ready(init);
    </script>

</head>
<body>

</body>
<nav class="navbar bg-light">
    <button id="btnShow" class="btn btn-info m-4 ">show Records</button>
    <button id="btnFind" class="btn btn-primary m-4">find Records</button>
    <button id="btnAdd" class="btn btn-secondary m-4">Add Records</button>
    
</nav>
<h1>Expense Manager</h1>
<hr />
<div>
    <p>Expense data</p>
</div>
<div class="container">
    <div class="row">
        <div class="col-md-11">
            <input type="search" id="txtSearch" placeholder="Search Expense by desc" class="form-control" onchange="findRecords()" />
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>ExpenseId</th>
                        <th>ExpenseAmount</th>
                        <th>ExpenseDesc</th>
                        <th>ExpenseDate</th>
                        
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>     
</div>
</html>











































using Microsoft.EntityFrameworkCore;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace ExpenseManager.Models
{
    [Table("ExpenseDb")]
    public class Expense
    {
        [Key]
        public int ExpenseId { get; set; }
        public int ExpenseAmount {  get; set; }
        public string ExpenseDesc {  get; set; }=string.Empty;
        public DateTime ExpenseDate { get; set; }
        
    }
    public class ExpenseDbContext : DbContext
    {
        public DbSet<Expense> Expenses { get; set; }

        public ExpenseDbContext(DbContextOptions options) : base(options) { }
    }
}




























public class ExpenseController : Controller
{
    private readonly ExpenseContext _context;

    public ExpenseController(ExpenseContext context)
    {
        _context = context;
    }

    // View to Add Expense
    public IActionResult Add()
    {
        return View();
    }

    // Add Expense Post Action
    [HttpPost]
    public async Task<IActionResult> Add(Expense expense)
    {
        if (ModelState.IsValid)
        {
            _context.Expenses.Add(expense);
            await _context.SaveChangesAsync();
            return RedirectToAction("Index"); // Redirect to a list or confirmation page
        }
        return View(expense);
    }

    // View to Find Expenses
    public IActionResult Find()
    {
        return View();
    }

    // Find Expenses by Date
    [HttpPost]
    public async Task<IActionResult> FindByDate(DateTime date)
    {
        var expenses = await _context.Expenses.Where(e => e.Date.Date == date.Date).ToListAsync();
        return View("FindResults", expenses);
    }

    // Find Expenses by Description
    [HttpPost]
    public async Task<IActionResult> FindByDescription(string description)
    {
        var expenses = await _context.Expenses.Where(e => e.Description.Contains(description)).ToListAsync();
        return View("FindResults", expenses);
    }

    // Find Expenses by Month
    [HttpPost]
    public async Task<IActionResult> FindByMonth(int month)
    {
        var expenses = await _context.Expenses.Where(e => e.Date.Month == month).ToListAsync();
        return View("FindResults", expenses);
    }
}










[Route("api/[controller]")]
[ApiController]
public class ExpenseController : ControllerBase
{
    private readonly ExpenseContext _context;

    public ExpenseController(ExpenseContext context)
    {
        _context = context;
    }

    [HttpPost]
    public async Task<IActionResult> AddExpense([FromBody] Expense expense)
    {
        _context.Expenses.Add(expense);
        await _context.SaveChangesAsync();
        return Ok(expense);
    }

    [HttpGet("date/{date}")]
    public async Task<IActionResult> GetExpensesByDate(DateTime date)
    {
        var expenses = await _context.Expenses.Where(e => e.Date.Date == date.Date).ToListAsync();
        return Ok(expenses);
    }

    [HttpGet("description/{description}")]
    public async Task<IActionResult> GetExpensesByDescription(string description)
    {
        var expenses = await _context.Expenses.Where(e => e.Description.Contains(description)).ToListAsync();
        return Ok(expenses);
    }

    [HttpGet("month/{month}")]
    public async Task<IActionResult> GetExpensesByMonth(int month)
    {
        var expenses = await _context.Expenses.Where(e => e.Date.Month == month).ToListAsync();
        return Ok(expenses);
    }
}


$(document).ready(function(){
    $("#addExpenseForm").submit(function(event){
        event.preventDefault();
        var expenseData = {
            date: $("#date").val(),
            amount: $("#amount").val(),
            description: $("#description").val()
        };
        
        $.ajax({
            url: "/api/expenses",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(expenseData),
            success: function(result){
                alert("Expense added successfully!");
            }
        });
    });
});
